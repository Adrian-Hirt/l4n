%nav.navbar.navbar-expand-md.navbar-dark.fixed-top.bg-dark
  .container-fluid
    %a.navbar-brand{:href => "#"} L4N Dev
    %button.navbar-toggler{"aria-controls" => "navbarCollapse", "aria-expanded" => "false", "aria-label" => "Toggle navigation", "data-bs-target" => "#navbarCollapse", "data-bs-toggle" => "collapse", :type => "button"}
      %span.navbar-toggler-icon
    #navbarCollapse.collapse.navbar-collapse
      -# Left dynamic menu
      %ul.navbar-nav.me-auto.mb-2.mb-md-0
        %li.nav-item
          = link_to _('Homepage'), root_path, class: 'nav-link ' + navbar_item_active_classes(:home)

        - Queries::MenuItem::FindActiveTopElements.call.each do |menu_item|
          - next unless menu_item.visible?

          - if menu_item.is_a? MenuDropdownItem
            %li.nav-item.dropdown
              %a.nav-link{data: { 'bs-toggle' => :dropdown}, href: '#', class: menu_item_active_classes(menu_item)}
                = menu_item.title
                = icon %i[fa fa-chevron-down]
              %ul.dropdown-menu.dropdown-menu-dark
                - menu_item.children.each do |child_menu_item|
                  - next unless child_menu_item.visible?
                  %a.dropdown-item{href: "/#{child_menu_item.linked_page_url}", class: menu_item_active_classes(child_menu_item)}
                    = child_menu_item.title
          - else
            %li.nav-item
              %a.nav-link{href: "/#{menu_item.linked_page_url}", class: menu_item_active_classes(menu_item)}
                = menu_item.title
      -# Right menu
      %ul.order-1.order-md-3.navbar-nav.ml-auto
        %li.nav-item
          = link_to toggle_dark_mode_path, class: %i[nav-link], data: { turbo_method: :post } do
            = icon %i[fa fa-adjust]
        %li.nav-item.dropdown
          %a.nav-link{data: { 'bs-toggle' => :dropdown}, href: '#'}
            = icon %i[fa fa-lg fa-language]
            = icon %i[fa fa-chevron-down]
          %ul.dropdown-menu.dropdown-menu-end.dropdown-menu-dark
            = link_to set_locale_path(locale: :en), data: { turbo_method: :post }, class: 'dropdown-item' + active_locale_class(:en) do
              = _('Language|English')
            = link_to set_locale_path(locale: :de), data: { turbo_method: :post }, class: 'dropdown-item' + active_locale_class(:de) do
              = _('Language|German')
        %li.nav-item.dropdown
          - if current_user
            %a.nav-link{data: { 'bs-toggle' => :dropdown}, href: '#'}
              %div{style: 'height: 100%;'}
                -# - if current_user.thumb_avatar.present?
                -#   = image_tag current_user.thumb_avatar, class: %i[img-circle mr-2], style: 'height: 100%;'
                -# - else
                -#   = icon %i[fas fa-user mr-2]
                = current_user.username
                = icon %i[fa fa-chevron-down]
            %ul.dropdown-menu.dropdown-menu-end.dropdown-menu-dark
              %li
                = link_to _('Settings|Edit profile'), settings_profile_path, class: %i[dropdown-item]
              %li.dropdown-divider
              - if can? :access, :admin_panel
                = link_to _('Admin Panel'), admin_path, class: %i[dropdown-item]
                %li.dropdown-divider
              %li
                = button_to logout_path, method: :delete, class: 'dropdown-item' do
                  = icon %i[fa fa-sign-out-alt]
                  = ('User|Logout')
          - elsif FeatureFlag.enabled?(:user_registration)
            %a.nav-link.dropdown-toggle{data: { 'bs-toggle' => :dropdown}, href: '#'}= _('Login / Sign up')
            %ul.dropdown-menu.dropdown-menu-end.dropdown-menu-dark
              %li
                = link_to _('User|Login'), login_path, class: %i[dropdown-item]
              %li
                = link_to _('User|Sign up'), signup_path, class: %i[dropdown-item]
          - else
            %li.nav-item
              = link_to _('User|Login'), login_path, class: %i[nav-link]
